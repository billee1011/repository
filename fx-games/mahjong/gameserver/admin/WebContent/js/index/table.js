
﻿var TableResize=function(handlerEls,getTargets){this.handlerEls="string"==typeof handlerEls?$(handlerEls):handlerEls;this.getTargets=getTargets;};TableResize.prototype={constructor:TableResize,init:function(){var that=this;var targetEls=null;var originWidth=0;if(!this.handlerEls||"function"!=typeof this.getTargets){return;}
this.handlerEls.draggit(this._dragProxy,{start:function(captureEl){targetEls=that.getTargets(captureEl);originWidth=$(targetEls[0]).width();$(document.body).addClass('resize_table');},drag:function(captureEl,diffX,diffY){var w=Math.max(originWidth-1+diffX,qcloudTable.MIN_WIDTH);var ind=$('[_resize_ico]',targetEls[0]).attr("_resize_ico");targetEls.each(function(){if('th'==this.tagName.toLowerCase()){$(this).width(w);return;}
if(qcloudTable.headerOpts.isNoCheckboxCol){$(this).width(1==ind?w-5:w-1);}else{$(this).width(2==ind?w-7:w-1);}});qcloudTable.adjustLastCol();qcloudTable.adjustContTbEl(ind,w);},stop:function(captureEl){targetEls=null;$(document.body).removeClass('resize_table');}});},_dragProxy:$('<div style="display:none;"></div>').appendTo(document.body)[0]};var qcloudTable=(function(){var lastColWidth;var titleTbEl;var contTbEl;var _sortFn;var MIN_WIDTH=100;var theCols=null;var _getColWidth=function(){var widthArr=[];var tw=$('.bd').width();var length=$('th',titleTbEl[0]).length;var aw=Math.ceil((tw-34)/(length-1));$('th',titleTbEl[0]).each(function(){widthArr.push($(this).width());});if(_numArrSum(widthArr)+10<tw){widthArr=[34];for(var i=length-2;0<=i;i--){widthArr.push(aw);}}
var lessWidth=0;var _num=0;var _w=0;if(theCols){for(var j=1;j<widthArr.length;j++){if(theCols[j-1]&&theCols[j-1].minWidth){_num++;if(widthArr[j]<theCols[j-1].minWidth){lessWidth=lessWidth+theCols[j-1].minWidth-widthArr[j];widthArr[j]=theCols[j-1].minWidth;}}}
if(lessWidth){_w=lessWidth/(widthArr.length-1-_num);for(j=1;j<widthArr.length;j++){if(!(theCols[j-1]&&theCols[j-1].minWidth)){widthArr[j]=Math.ceil(widthArr[j]-_w);}}}}
return widthArr;};var setTitle=function(cols,sortInfo,opts){var len=cols.length;var i=0;opts=opts||{};qcloudTable.headerOpts=opts;theCols=cols;titleTbEl.html($.tmpl(qcloudTable.tmpl.title,{list:cols,opts:opts})).find('th').each(function(){i++;$(this).find('.ico_stick_right').attr('_resize_ico',i);});var sortTitle=titleTbEl.find('.op_rank[_id='+sortInfo.id+']');if(sortTitle.length>0){sortTitle.attr('_status',sortInfo.type).addClass('sorted');if('down'==sortInfo.type){sortTitle.find('.ico').addClass('ico_trangledown').removeClass('ico_trangleup').show();}else{sortTitle.find('.ico').removeClass('ico_trangledown').addClass('ico_trangleup').show();}}
new TableResize('[_resize_ico]',function(el){var _ind=$(el).attr('_resize_ico');return titleTbEl.find('th:nth-child('+_ind+')').add(contTbEl.find('tr:nth-child(1) td:nth-child('+_ind+')'));}).init();setTimeout(function(){adjustWidth();},100);};var _numArrSum=function(numArr){var t=0;for(var i=numArr.length-1;i>=0;i--){t+=numArr[i];}
return t;};var isAdd1=0;var adjustWidth=function(){var colWidth=_getColWidth();var i=0;var tmpNum;var firstRowTd=$('tr:nth-child(1) td',contTbEl[0]);var tdLength=firstRowTd.length;var _btWidth=$('.bd_content_table table').width();var _ctWidth=$('.bd_title_table table').width();if(_btWidth<_ctWidth){isAdd1=1;}else if(_btWidth>_ctWidth+3){isAdd1=0;}
titleTbEl.css('width',$('.bd').width()-2).find('th').css('width','auto');colWidth=_getColWidth();colWidth[colWidth.length-1]-=Math.max(0,_numArrSum(colWidth)-titleTbEl.width());lastColWidth=colWidth[colWidth.length-1];titleTbEl.find('th').each(function(){$(this).width(Math.max(colWidth[i++],MIN_WIDTH));}).end().css('width','0');i=0;firstRowTd.each(function(){if(!qcloudTable.headerOpts.isNoCheckboxCol){if(1==i){tmpNum=-7;}else if(tdLength-1==i){tmpNum=4;}else{tmpNum=-1;}}else{if(0===i){tmpNum=-6;}else if(tdLength-1==i){tmpNum=4;}else{tmpNum=-2;}}
$(this).width(Math.max(colWidth[i++]+tmpNum,MIN_WIDTH+tmpNum)+isAdd1);});contTbEl.find('td').each(function(){var w=$(this).width();$(this).find('.textoverflow').width(w-20);});$('.table_area').width($('.bd').width()-2);$('#cont_table_area,.table_area .bd_title_table').width(Math.max(contTbEl.width(),contTbEl.find('tbody').width(),$('.bd').width()-1)-1);};var adjustLastCol=function(){var isSecCol=false;var lastTh=titleTbEl.find('th:last-child');var tmpNum;tmpNum=titleTbEl.parent().width()-titleTbEl.find('thead').width();tmpNum=Math.max(lastTh.width()+tmpNum,lastColWidth,MIN_WIDTH);lastTh.width(tmpNum);contTbEl.find('tr:nth-child(1) td:last-child').width(tmpNum+4);tmpNum=Math.max(contTbEl.width(),contTbEl.find('tbody').width())-1;if(200<tmpNum){$('#cont_table_area').width(tmpNum);}};var adjustContTbEl=function(colNum,width){width=width-20;contTbEl.find('tr td:nth-child('+colNum+')').find('.textoverflow').width(width);};var sort=function(el){if($(el).find('.ico').length===0){return;}
var curStatus=$(el).attr('_status');var id=$(el).attr('_id');var newStatus;var isSorted=$(el).hasClass('sorted');titleTbEl.find('.op_rank').removeClass('sorted');if(isSorted){if('down'==curStatus){newStatus='up';$('.ico',el).removeClass('ico_trangledown').addClass('ico_trangleup');}else{newStatus='down';$('.ico',el).removeClass('ico_trangleup').addClass('ico_trangledown');}}else{newStatus='down';}
$(el).attr('_status',newStatus).addClass('sorted');if('function'==typeof _sortFn){_sortFn(id,newStatus);}};var init=function(titleTableEl,contTableEl,sortFn){var i=0,tmpArr;titleTbEl=titleTableEl;contTbEl=contTableEl;_sortFn=sortFn;titleTbEl.find('th').each(function(){i=i+1;$(this).find('.ico_stick_right').attr('_resize_ico',i);});adjustWidth();titleTbEl.css('width','0');contTbEl.css('width','0');new TableResize('[_resize_ico]',function(el){var _ind=$(el).attr('_resize_ico');return titleTbEl.find('th:nth-child('+_ind+')').add(contTbEl.find('tr:nth-child(1) td:nth-child('+_ind+')'));}).init();$(window).resize(function(){adjustWidth();});titleTbEl.on('mouseover','.op_rank',function(){$(this).find('.ico').show();}).on('mouseout','.op_rank',function(){if(!$(this).hasClass('sorted')){$(this).find('.ico').hide();}});};return{init:init,adjustWidth:adjustWidth,adjustLastCol:adjustLastCol,adjustContTbEl:adjustContTbEl,setTitle:setTitle,sort:sort,tmpl:{},MIN_WIDTH:MIN_WIDTH};})();window.qcloudTable.tmpl.title='<colgroup><% if( !opts.isNoCheckboxCol ){ %><col class="col1"><% } %><% for( var i=0, len=list.length; i<len; i++ ){ %><col class="col<%= i + 2 %>"><% } %></colgroup><thead><tr><% if( !opts.isNoCheckboxCol ){ %><th><div class="op"><a href="javascript:void(0);" onclick="return false;" class="btn_select_16"><span class="visually_hidden">checkbox</span></a></div></th><% } %><% for( var i=0, len=list.length; i<len; i++ ){ %><th><div class="op"><% if( 0 == i && !opts.isNoCheckboxCol ){ %><i class="ico ico_stick_left"></i><% } %><a href="javascript:void(0);" onclick="qcloudTable.sort(this);return false;" title="<%= list[i].name %>" _id="<%= list[i].id %>" _status="down" class="op_rank textoverflow"><span class="table_title"><%= list[i].name %></span><% if(list[i].sortable){ %><i class="ico ico_trangledown" style="display:none;"></i><% } %></a><% if( i<len-1 || !list.noOperation || opts.isNoOperatoinCol ){ %><i class="ico ico_stick_right"></i><% } %></div></th><% } %><% if( !list.noOperation || opts.isNoOperatoinCol ){ %><th><div class="op"><a href="javascript:void(0);" style="cursor:default;" class="op_rank"><span class="table_title">操作</span></a></div></th><% } %></tr></thead>';/*  |xGv00|189103f4eb7ddf20afd339a5d1206b86 */